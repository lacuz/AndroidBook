# 死亡问答

## 业务稳定性如何保障？
* 数据采集 + 报警
* 需要对项目的主流程与核心路径进行埋点监控，
* 同时还需知道每一步发生了多少异常，这样，我们就知道了所有业务流程
的转换率以及相应界面的转换率
* 结合大盘，如果转换率低于某个值，进行报警
* 异常监控 + 单点追查
* 兜底策略

移动端业务高可用它侧重于用户功能完整可用，主要是为了解决一些线上一些异常情况导致用户他虽然没有崩溃，也没有性能问题，但是呢，只是单纯的功能不可用的情况，我们需要对项目的主流程、核心路径进行埋点监控，来计算每一步它真实的转换率是多少，同时呢，还需要知道在每一步到底发生了多少异常。这样我们就知道了所有业务流程的转换率以及相应界面的转换率，有了大盘的数据呢，我们就知道了，如果转换率或者是某些监控的成功率低于某个值，那很有可能就是出现了线上异常，结合了相应的报警功能，我们就不需要等用户来反馈了，这个就是业务稳定性保障的基础。

同时呢，对于一些特殊情况，比如说，开发过程当中或代码中出现了一些 catch代码块，捕获住了异常，让程序不崩溃，这其实是不合理的，程序虽然没有崩溃，当时程序的功能已经变得不可用，所以呢，这些被 catch 的异常我们也需要上报上来，这样我们才能知道用户到底出现了什么问题而导致的异常。此外，线上还有一些单点问题，比如说用户点击登录一直进不去，这种就属于单点问题，其实我们是无法找出其和其它问题的共性之处的，所以呢，我们就必须要找到它对应的详细信息。
最后，如果发生了异常情况，我们还采取了一系列措施进行快速止损。

## 如果发生了异常情况，怎么快速止损？
* 功能开关
* 统跳中心
* 动态修复：热修复、资源包更新
* 自主修复：安全模式

首先，需要让 App 具备一些高级的能力，我们对于任何要上线的新功能，要加上一个功能的开关，通过配置中心下发的开关呢，来决定是否要显示新功能的入口。如果有异常情况，可以紧急闭新功能的入口，那就可以让这个 App 处于可控的状态了。

然后，我们需要给 App 设立路由跳转，所有的界面跳转都需要通过路由来分发，如果我们匹配到需要跳转到有 bug 的这样一个新功能时，那我们就不跳转了，或者是跳转到统一的异常正处理中的界面。如果这两种方式都不可以，那就可以考虑通过热修复的方式来动态修复，目前热修复的方案其实已经比较成熟了，我们完全可以低成本地在我们的项目中添加热修复的能力，当然，如果有些功能是由 RN 或 WeeX 来实现就更好了，那就可以通过更新资源包的方式来实现动态更新。而这些如果都不可以的话呢，那就可以考虑自己去给应用加上一个自主修复的能力，如果 App 启动多次的话，那就可以考虑清空所有的缓存数据，将 App重置到安装的状态，到了最严重的等呢，可以阻塞主线程，此时一定要等 App热修复成功之后才允许用户进入。